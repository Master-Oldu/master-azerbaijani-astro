---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter(p => {
    // In dev, show everything
    if (import.meta.env.DEV) return true;

    // In production, hide future posts
    return new Date(p.data.pubDate) <= new Date();
  })
  .sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate));
---

<BaseHead 
  title="Blog - Master Azerbaijani"
  description="Read expert tips, cultural insights, and language guides to help you learn Azerbaijani faster and more confidently. New posts are published every 10 days."
/>

<Header />

<main class="page-container blog-page">
  <h1>Blog</h1>

  <p
    style="
      font-size: 1.5rem;
      opacity: 0.9;
      max-width: 900px;
      margin: 0 auto 40px;
      line-height: 1.5;
    "
  >
    Welcome to the Master Azerbaijani blog! Here, youâ€™ll find posts on language tips,
    cultural insights, and updates about the platform.
  </p>

<div class="post-grid">
  {posts.map((post) => (
    <a class="post-card" href={`/blog/${post.slug}`}>
      <div class="post-image">
        <img src={post.data.coverImage} alt={post.data.coverImageAlt} />
      </div>

      <div class="post-info">
        <h3>{post.data.title}</h3>

        <p class="post-date">
          {new Date(post.data.pubDate).toLocaleDateString("en-US", {
            month: "short",
            day: "numeric",
            year: "numeric"
          })}
        </p>

        <p class="post-excerpt">
          {post.data.description}
        </p>
      </div>
    </a>
  ))}
</div>

</main>

<Footer />
